<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoHW Registry Documentation</title>
    <link rel="stylesheet" href="../shared-styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>PROOF OF HUMAN WORK â€” REGISTRY NODE OPERATION</h1>
                <p class="subtitle">How to run and operate a PoHW registry node</p>
            </div>
        </header>

        <main>
            <div class="info-card">
                <div class="card-header">
                    <h2>OVERVIEW</h2>
                </div>
                <div class="content-section">
                    <p>Registry nodes are the persistence layer of the PoHW protocol. They maintain Merkle trees of attestations and anchor roots to multiple blockchains and archival substrates.</p>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>HOW TO RUN A PoHW REGISTRY NODE</h2>
                </div>
                <div class="content-section">
                    <h3>Prerequisites:</h3>
                    <ul class="info-list">
                        <li>Server with persistent storage</li>
                        <li>Network access to blockchain nodes</li>
                        <li>SSL certificate for HTTPS</li>
                        <li>Public IP address</li>
                    </ul>

                    <h3>Step 1: Install Registry Software</h3>
                    <pre><code>$ git clone https://github.com/pohw/registry-node
$ cd registry-node
$ npm install  # or appropriate package manager</code></pre>

                    <h3>Step 2: Configure Node</h3>
                    <p>Create config.json:</p>
                    <pre><code>{
  "node_id": "your-node-id",
  "merkle_batch_size": 1000,
  "anchor_interval": 3600,
  "chains": ["bitcoin", "ethereum"],
  "storage": {
    "type": "postgresql",
    "connection": "..."
  }
}</code></pre>

                    <h3>Step 3: Initialize Merkle Tree</h3>
                    <pre><code>$ pohw-registry init</code></pre>

                    <h3>Step 4: Start Node</h3>
                    <pre><code>$ pohw-registry start</code></pre>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>MERKLE BATCHING</h2>
                </div>
                <div class="content-section">
                    <p>Registry nodes batch attestations into Merkle trees:</p>
                    <ol class="info-list" style="list-style: decimal; padding-left: 2rem;">
                        <li>Accept attestation submissions</li>
                        <li>Validate signatures</li>
                        <li>Add to pending batch</li>
                        <li>When batch size reached, build Merkle tree</li>
                        <li>Generate Merkle root</li>
                        <li>Anchor root to chains</li>
                        <li>Make proofs available</li>
                    </ol>
                    <p><strong>Batch Size:</strong> Configurable (default: 1000 attestations)</p>
                    <p><strong>Anchor Interval:</strong> Periodic anchoring even if batch not full</p>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>MULTI-CHAIN ANCHORING</h2>
                </div>
                <div class="content-section">
                    <p>Registry nodes anchor Merkle roots to multiple chains:</p>
                    <h3>Supported Chains:</h3>
                    <ul class="info-list">
                        <li>Bitcoin (OP_RETURN)</li>
                        <li>Ethereum (contract or transaction)</li>
                        <li>IPFS (content addressing)</li>
                        <li>Arweave (permanent storage)</li>
                    </ul>

                    <h3>Anchor Format:</h3>
                    <pre><code>{
  "merkle_root": "0x...",
  "timestamp": "2025-11-25T00:00:00Z",
  "block_height": 12345,
  "tx_hash": "0x...",
  "chain": "bitcoin"
}</code></pre>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>CROSS-REGISTRY SYNC</h2>
                </div>
                <div class="content-section">
                    <p>Registry nodes sync with each other:</p>
                    <ol class="info-list" style="list-style: decimal; padding-left: 2rem;">
                        <li>Discover other nodes via registry list</li>
                        <li>Exchange Merkle roots periodically</li>
                        <li>Verify roots match (consensus)</li>
                        <li>Replicate attestations for redundancy</li>
                        <li>Handle conflicts via transparency logs</li>
                    </ol>

                    <h3>Sync Protocol:</h3>
                    <ul class="info-list">
                        <li>HTTP-based sync API</li>
                        <li>Merkle root exchange</li>
                        <li>Conflict resolution</li>
                        <li>State reconciliation</li>
                    </ul>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>AUDIT LOGS</h2>
                </div>
                <div class="content-section">
                    <p>Every registry node maintains public audit logs:</p>
                    <h3>Log Entries Include:</h3>
                    <ul class="info-list">
                        <li>Attestation submissions (hash, timestamp)</li>
                        <li>Merkle tree constructions (root, size)</li>
                        <li>Chain anchorings (chain, tx, height)</li>
                        <li>Sync events (peer, action)</li>
                        <li>Errors and warnings</li>
                    </ul>

                    <h3>Audit Log Format:</h3>
                    <pre><code>{
  "timestamp": "2025-11-25T00:00:00Z",
  "type": "attestation|merkle|anchor|sync|error",
  "data": {...}
}</code></pre>

                    <p><strong>Public Access:</strong> GET /pohw/audit?from=timestamp&to=timestamp</p>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>REVOCATION RULES</h2>
                </div>
                <div class="content-section">
                    <p>Attestations can be revoked by signer:</p>
                    <ol class="info-list" style="list-style: decimal; padding-left: 2rem;">
                        <li>Signer submits revocation request</li>
                        <li>Registry validates signature</li>
                        <li>Mark attestation as revoked</li>
                        <li>Update Merkle tree (new root)</li>
                        <li>Anchor revocation to chains</li>
                        <li>Propagate to other nodes</li>
                    </ol>

                    <h3>Revocation Format:</h3>
                    <pre><code>{
  "hash": "0x...",
  "signature": "...",
  "revocation_reason": "optional",
  "timestamp": "2025-11-25T00:00:00Z"
}</code></pre>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>FEDERATION POLICIES</h2>
                </div>
                <div class="content-section">
                    <p>Registry nodes form federations:</p>
                    <h3>Federation Rules:</h3>
                    <ul class="info-list">
                        <li>Nodes must maintain public keys</li>
                        <li>Nodes must provide audit logs</li>
                        <li>Nodes must anchor to at least 2 chains</li>
                        <li>Nodes must sync with peers</li>
                        <li>Nodes must follow consensus protocol</li>
                    </ul>

                    <h3>Federation Discovery:</h3>
                    <ul class="info-list">
                        <li>Central registry list (proofofhumanwork.org)</li>
                        <li>DNS-based discovery</li>
                        <li>Peer-to-peer announcement</li>
                    </ul>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>REQUIREMENTS FOR REGISTRY OPERATORS</h2>
                </div>
                <div class="content-section">
                    <h3>Minimum Requirements:</h3>
                    <ul class="info-list">
                        <li>99% uptime</li>
                        <li>&lt; 1 hour anchoring latency</li>
                        <li>Public audit logs</li>
                        <li>CORS enabled for verification</li>
                        <li>SSL certificate</li>
                        <li>Persistent storage</li>
                        <li>Multiple chain access</li>
                    </ul>

                    <h3>Recommended:</h3>
                    <ul class="info-list">
                        <li>Redundant infrastructure</li>
                        <li>Monitoring and alerting</li>
                        <li>Backup procedures</li>
                        <li>Rate limiting</li>
                        <li>DDoS protection</li>
                    </ul>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>REGISTRY API ENDPOINTS</h2>
                </div>
                <div class="content-section">
                    <h3>POST /pohw/attest</h3>
                    <p>Submit attestation</p>
                    <p><strong>Auth:</strong> Signature verification</p>
                    <p><strong>Response:</strong> {receipt_hash, merkle_root}</p>

                    <h3>GET /pohw/verify/{hash}</h3>
                    <p>Verify attestation</p>
                    <p><strong>Response:</strong> {valid, signer, timestamp, merkle_proof}</p>

                    <h3>GET /pohw/proof/{hash}</h3>
                    <p>Get Merkle proof</p>
                    <p><strong>Response:</strong> {proof, root, anchors}</p>

                    <h3>GET /pohw/status</h3>
                    <p>Node status</p>
                    <p><strong>Response:</strong> {status, latest_root, anchored_at, sync_status}</p>

                    <h3>GET /pohw/audit</h3>
                    <p>Audit logs</p>
                    <p><strong>Query:</strong> from, to, limit</p>
                    <p><strong>Response:</strong> [{timestamp, type, data}, ...]</p>

                    <h3>GET /pohw/peers</h3>
                    <p>List peer nodes</p>
                    <p><strong>Response:</strong> [{node_id, url, status}, ...]</p>
                </div>
            </div>

            <div class="info-card">
                <div class="card-header">
                    <h2>MONITORING</h2>
                </div>
                <div class="content-section">
                    <p>Registry nodes should expose metrics:</p>
                    <ul class="info-list">
                        <li>Attestations per second</li>
                        <li>Merkle tree size</li>
                        <li>Anchoring latency</li>
                        <li>Sync status</li>
                        <li>Error rates</li>
                        <li>Storage usage</li>
                    </ul>
                    <p><strong>Monitoring Endpoint:</strong> GET /pohw/metrics</p>
                </div>
            </div>
        </main>

        <footer>
            <p>Protocol: Proof of Human Work v1.0.0</p>
            <p>
                <a href="../">Home</a> | 
                <a href="../attestors/">Attestors</a> | 
                <a href="../docs/">Documentation</a> | 
                <a href="https://github.com/gdnshnk/pohw-registry-node" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>
</body>
</html>
